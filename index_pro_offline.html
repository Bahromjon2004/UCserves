<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PUBG Mobile UC ‚Äî Eng arzon, tezkor, ishonchli</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f14;
      --card:#0f1720;
      --muted:#9aa3b2;
      --text:#eef2f7;
      --accent1:#ff6b35;
      --accent2:#f7931e;
      --glass: rgba(255,255,255,0.06);
      --ring: rgba(45,212,191,.20);
      --shadow: 0 12px 40px rgba(2,6,23,.6);
      --glass-border: rgba(255,255,255,.06);
      --glass-strong: rgba(255,255,255,.08);
    }
    [data-theme="light"]{
      --bg: linear-gradient(180deg,#f6f8fb,#eef2ff);
      --card:#ffffff;
      --muted:#6b7280;
      --text:#0b1220;
      --glass: rgba(0,0,0,0.04);
      --glass-border: rgba(2,6,23,0.06);
      --shadow: 0 8px 24px rgba(2,6,23,.06);
    }

    html,body{ height:100%; margin:0; font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

    /* Background image + overlay */
    body{
      background-image:
        linear-gradient(180deg, rgba(2,6,23,.6), rgba(2,6,23,.65)),
        url("https://images.unsplash.com/photo-1600810189637-c9a99a8f9a0f?q=80&w=1800&auto=format&fit=crop&ixlib=rb-4.0.3&s=5f6bdc92d7a4f9f1b9b6a1ad0b2d7c5c");
      background-size:cover;
      background-position:center;
      background-attachment:fixed;
    }

    .container{ max-width:1200px; margin:0 auto; padding:20px; }

    /* Topbar */
    .topbar{ display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:18px; }
    .brand{ display:flex; gap:12px; align-items:center; text-decoration:none; color:var(--text); }
    .logo{ width:44px; height:44px; display:grid; place-items:center; border-radius:10px; background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#111; font-weight:900; box-shadow:var(--shadow); }
    .title{ font-weight:800; letter-spacing:.4px; }
    .subtitle{ font-size:13px; color:var(--muted); margin-top:-3px; }

    .actions{ display:flex; gap:8px; align-items:center; }
    .btn{ padding:9px 12px; border-radius:10px; background:var(--glass); border:1px solid var(--glass-border); color:var(--text); cursor:pointer; font-weight:700; }
    .btn.primary{ background: linear-gradient(90deg,var(--accent1),var(--accent2)); color:#111; border-color:transparent; box-shadow: 0 8px 30px rgba(247,147,30,.12); }

    /* Layout */
    .hero{ display:grid; grid-template-columns: 1fr 380px; gap:20px; align-items:start; margin-bottom:16px; }
    .panel{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:16px; border:1px solid var(--glass-border); box-shadow:var(--shadow); backdrop-filter: blur(6px); }
    .hero h1{ margin:0; font-size:clamp(20px,3.4vw,34px); line-height:1.05; background: linear-gradient(90deg,var(--accent1),var(--accent2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .muted{ color:var(--muted); }

    .controls{ display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; }
    .input{ display:flex; align-items:center; gap:8px; background:var(--glass); padding:10px 12px; border-radius:10px; border:1px solid var(--glass-border); min-width:160px; color:var(--text); }
    .input input, .input select{ all:unset; color:var(--text); width:100%; }

    /* Grid */
    .grid{ display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:14px; margin-top:14px; }
    .card{ border-radius:12px; padding:12px; position:relative; overflow:hidden; border:1px solid var(--glass-border); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); }
    .tag{ position:absolute; top:10px; right:10px; padding:6px 10px; border-radius:999px; font-weight:800; background: linear-gradient(90deg,var(--accent2),var(--accent1)); color:#111; }

    .amount{ font-weight:900; font-size:18px; }
    .price{ color:var(--accent2); font-weight:800; margin-top:8px; }

    .cta{ display:flex; gap:8px; margin-top:12px; align-items:center; }

    /* Payments */
    .payments{ display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:12px; margin-top:8px; }

    /* Stats */
    .stats{ display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:12px; margin-top:16px; }
    .stat{ padding:12px; border-radius:12px; text-align:center; }

    /* Testimonials */
    .testimonials{ display:grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:12px; margin-top:12px; }

    /* Cart Drawer / Mobile */
    .drawer{ position:fixed; right:12px; bottom:12px; width:360px; max-width:calc(100% - 24px); background:var(--card); border-radius:12px; border:1px solid var(--glass-border); box-shadow: 0 20px 60px rgba(0,0,0,.6); z-index:1000; padding:12px; display:flex; flex-direction:column; gap:8px; }
    .drawer.hidden{ display:none; }
    .cart-item{ display:flex; justify-content:space-between; align-items:center; gap:8px; background:var(--glass); padding:8px; border-radius:10px; border:1px solid rgba(255,255,255,.03); }
    .cart-actions{ display:flex; gap:8px; align-items:center; }

    /* Modal */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,0.6); display:none; align-items:center; justify-content:center; z-index:2000; }
    .modal{ width:min(720px,96vw); background:var(--card); border-radius:12px; padding:16px; border:1px solid var(--glass-border); }

    /* Toasts */
    .toasts{ position:fixed; left:12px; bottom:12px; display:flex; flex-direction:column; gap:8px; z-index:2500; }
    .toast{ background:var(--card); padding:10px 12px; border-radius:10px; border:1px solid var(--glass-border); box-shadow:var(--shadow); }

    /* Confetti simple */
    .confetti-piece{ position:fixed; width:8px; height:12px; z-index:3000; opacity:0.95; }

    /* Responsive */
    @media (max-width:1000px){ .hero{ grid-template-columns: 1fr 320px; } .drawer{ right:8px; bottom:8px; width:320px; } }
    @media (max-width:760px){
      .hero{ grid-template-columns:1fr; }
      .drawer{ position:fixed; left:12px; right:12px; bottom:12px; width:auto; max-width:calc(100% - 24px); }
      .topbar{ gap:8px; }
    }
  </style>
</head>
<body data-theme="dark">
  <div class="container">
    <header class="topbar">
      <a class="brand" href="#">
        <div class="logo">UC</div>
        <div>
          <div class="title">PUBG MOBILE UC</div>
          <div class="subtitle">Doimiy ID orqali UC ‚Äî tezkor yetkazib berish</div>
        </div>
      </a>

      <div class="actions">
        <button id="themeToggle" class="btn" title="Theme">üåì</button>
        <button id="openCartBtn" class="btn">üõí <span id="cartCountTop">0</span></button>
        <a class="btn primary" href="https://t.me/MengliyevBahrom" target="_blank" rel="noopener">üì® @MengliyevBahrom</a>
      </div>
    </header>

    <main>
      <section class="hero">
        <div class="panel">
          <h1 id="greet">Eng arzon narxlar ‚Äî 100% ishonchli</h1>
          <p class="muted">Sizga kerak bo‚Äòlgan UC paketini tanlang, ID kiritib ‚Äî Telegramga yuboring.</p>

          <div class="controls">
            <label class="input" style="min-width:260px">
              üîé <input id="search" placeholder="Qidirish: 660, 120, 25 200..." />
            </label>

            <label class="input" style="min-width:160px">
              ‚è´
              <select id="sort">
                <option value="asc">Arzondan qimmatga</option>
                <option value="desc">Qimmatdan arzonga</option>
              </select>
            </label>

            <div style="display:flex; gap:8px; align-items:center;">
              <button class="btn" id="clearFilters">Filtrni tozalash</button>
            </div>
          </div>

          <div class="panel" style="margin-top:12px;">
            <strong>‚è≥ Aksiya tugashiga qoldi:</strong>
            <div style="display:flex; gap:8px; margin-top:8px;">
              <div class="pill" style="background:var(--glass); padding:8px 10px; border-radius:10px;"><span id="d">--</span> kun</div>
              <div class="pill" style="background:var(--glass); padding:8px 10px; border-radius:10px;"><span id="h">--</span> soat</div>
              <div class="pill" style="background:var(--glass); padding:8px 10px; border-radius:10px;"><span id="m">--</span> daq</div>
              <div class="pill" style="background:var(--glass); padding:8px 10px; border-radius:10px;"><span id="s">--</span> son</div>
            </div>
          </div>
        </div>

        <aside class="panel">
          <h3>üí≥ TO'LOV KARTA RAQAMLARI</h3>
          <div class="payments">
            <div style="padding:10px; border-radius:10px; background:var(--glass);">
              <div style="font-weight:800">UZCARD</div>
              <button class="btn" data-copy="5614 6887 0039 5675">üìã Nusxa olish</button>
              <div class="muted" style="margin-top:6px;">Mengliyev Bahrom</div>
            </div>
            <div style="padding:10px; border-radius:10px; background:var(--glass);">
              <div style="font-weight:800">HUMO</div>
              <button class="btn" data-copy="9860 1201 4526 4012">üìã Nusxa olish</button>
              <div class="muted" style="margin-top:6px;">Mengliyev Bahrom</div>
            </div>
          </div>

          <div style="margin-top:12px;">
            <strong>Statistika</strong>
            <div class="stats" style="margin-top:8px;">
              <div class="stat panel"><div style="font-weight:900; font-size:18px" id="statOrders">0</div><div class="muted">Jami buyurtmalar</div></div>
              <div class="stat panel"><div style="font-weight:900; font-size:18px" id="statUC">0</div><div class="muted">Sotilgan UC</div></div>
              <div class="stat panel"><div style="font-weight:900; font-size:18px" id="statRate">5.0‚òÖ</div><div class="muted">Mijozlar bahosi</div></div>
            </div>
          </div>
        </aside>
      </section>

      <section class="panel">
        <h3>üì¶ Paketlar</h3>
        <div class="grid" id="grid"></div>
      </section>

      <section class="panel" style="margin-top:12px;">
        <h3>üí¨ Mijozlar fikrlari</h3>
        <div class="testimonials" id="testimonials"></div>
      </section>
    </main>
  </div>

  <!-- CART DRAWER -->
  <div id="drawer" class="drawer hidden" aria-hidden="true" role="dialog" aria-label="Cart">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div style="font-weight:900">üõí Savatcha</div>
      <div style="display:flex; gap:8px; align-items:center;">
        <div id="cartCountBadge" style="font-weight:800">0</div>
        <button class="btn" id="closeDrawerBtn">‚úñ</button>
      </div>
    </div>

    <div id="cartBody" style="max-height:260px; overflow:auto;"></div>

    <div style="display:flex; flex-direction:column; gap:8px;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div><strong>Jami:</strong></div>
        <div><strong id="cartTotal">0</strong> <span class="muted">so'm</span></div>
      </div>
      <div style="display:flex; gap:8px;">
        <button class="btn primary" id="orderCart">üöÄ Barchasini Telegramga yuborish</button>
        <button class="btn" id="clearCartBtn">Tozalash</button>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Buyurtma ma'lumoti</h3>
      <div id="modalPack" class="muted">‚Äî</div>

      <div style="margin-top:12px;">
        <label><strong>üî¢ PUBG ID</strong></label>
        <input id="playerId" type="text" inputmode="numeric" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--glass-border); background:var(--glass); color:var(--text);" placeholder="1234567890" />
      </div>

      <div style="margin-top:8px;">
        <label><strong>üìù Izoh (ixtiyoriy)</strong></label>
        <textarea id="note" rows="3" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--glass-border); background:var(--glass); color:var(--text);"></textarea>
      </div>

      <div style="margin-top:8px; display:flex; gap:8px;">
        <button class="btn" data-pay="UZCARD">UZCARD</button>
        <button class="btn" data-pay="HUMO">HUMO</button>
      </div>

      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button class="btn" id="closeModalBtn">Yopish</button>
        <button class="btn primary" id="sendTg">Telegramga yuborish</button>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div id="toasts" class="toasts"></div>

  <!-- Confetti container -->
  <div id="confettiRoot"></div>

  <script>
    // =========================
    // DATA / CONFIG
    // =========================
    const TG_USERNAME = "MengliyevBahrom";
    const PROMOS = { VIP10: 0.10, BAHROM15: 0.15 };
    // Fake purchase interval (ms). Real: 3600000 (1 hour). For testing, set to smaller (e.g., 15000).
    const FAKE_PURCHASE_INTERVAL = 3600000; // 1 hour
    const DEAL_END = new Date("2025-08-20T23:59:59+05:00").getTime();

    const PACKS = [
      { amount: "30 UC",    price: "8,000 so'm" },
      { amount: "60 UC",    price: "12,000 so'm" },
      { amount: "120 UC",   price: "24,000 so'm", tag: "MASHHUR" },
      { amount: "180 UC",   price: "36,000 so'm" },
      { amount: "325 UC",   price: "57,000 so'm", tag: "MASHHUR" },
      { amount: "355 UC",   price: "66,000 so'm" },
      { amount: "385 UC",   price: "70,000 so'm" },
      { amount: "445 UC",   price: "82,000 so'm" },
      { amount: "565 UC",   price: "108,000 so'm", tag: "TOP" },
      { amount: "660 UC",   price: "113,000 so'm" },
      { amount: "720 UC",   price: "126,000 so'm", tag: "MASHHUR" },
      { amount: "985 UC",   price: "172,000 so'm" },
      { amount: "1,320 UC", price: "225,000 so'm", tag: "TOP" },
      { amount: "1,800 UC", price: "285,000 so'm" },
      { amount: "1,920 UC", price: "315,000 so'm", tag: "MASHHUR" },
      { amount: "2,125 UC", price: "350,000 so'm" },
      { amount: "3,120 UC", price: "515,000 so'm", tag: "TOP" },
      { amount: "3,850 UC", price: "560,000 so'm" },
      { amount: "4,000 UC", price: "605,000 so'm", tag: "MASHHUR" },
      { amount: "6,000 UC", price: "925,000 so'm" },
      { amount: "8,100 UC", price: "1,100,000 so'm", tag: "TOP" },
      { amount: "8,400 UC", price: "1,160,000 so'm" },
      { amount: "16,800 UC", price: "2,450,000 so'm", tag: "VIP" },
      { amount: "25,200 UC", price: "3,650,000 so'm", tag: "VIP" },
      { amount: "33,600 UC", price: "4,850,000 so'm", tag: "VIP" },
      { amount: "42,000 UC", price: "6,050,000 so'm", tag: "PREMIUM" },
      { amount: "50,400 UC", price: "7,250,000 so'm", tag: "PREMIUM" },
      { amount: "84,000 UC", price: "12,000,000 so'm", tag: "MEGA" },
    ];

    const TESTIMONIALS = [
      { name: "Jahongir",  stars:5, text: "10 daqiqada keldi, zo‚Äòr xizmat!" },
      { name: "Aziza",     stars:5, text: "Narxlar juda ma‚Äôqul, rahmat!" },
      { name: "Murod",     stars:4, text: "Hammasi super, yana buyurtma qilaman." },
      { name: "Sardor",    stars:5, text: "Operator tez javob berdi. Tavsiya qilaman!" },
    ];

    // =========================
    // UTIL
    // =========================
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => [...el.querySelectorAll(s)];
    const save = (k,v) => localStorage.setItem(k, JSON.stringify(v));
    const load = (k, def) => {
      const v = localStorage.getItem(k);
      if(!v) return def;
      try { return JSON.parse(v); } catch { return def; }
    };
    const currencyToNumber = str => Number((str||"").replaceAll(",", "").replaceAll(" ", "").replace(/[^\d]/g,"")) || 0;
    const numberToCurrency = n => n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

    // =========================
    // STATE
    // =========================
    let wishlist = new Set(load("wishlist", []));
    let cart = load("cart", []);
    let promo = load("promo", null);

    // Stats persisted
    // statOrders: number, statUC: number, lastFake: timestamp (ms)
    let statOrders = load("statOrders", 1500);
    let statUC = load("statUC", 250000);
    let lastFake = load("lastFake", 0);

    // DOM refs
    const grid = $("#grid");
    const cartBody = $("#cartBody");
    const cartTotalEl = $("#cartTotal");
    const cartCountTop = $("#cartCountTop");
    const drawer = $("#drawer");
    const toasts = $("#toasts");
    const modalBackdrop = $("#modalBackdrop");
    const modalPack = $("#modalPack");
    const playerIdEl = $("#playerId");
    const noteEl = $("#note");

    // Modal internal
    let selectedPack = null;
    let selectedPay = "UZCARD";

    // =========================
    // RENDER PACKS
    // =========================
    function renderPacks(){
      grid.innerHTML = "";
      PACKS.forEach(p=>{
        const card = document.createElement("div");
        card.className = "card";
        if(p.tag) {
          const tag = document.createElement("div");
          tag.className = "tag";
          tag.textContent = p.tag;
          card.appendChild(tag);
        }
        const amount = document.createElement("div");
        amount.className = "amount";
        amount.textContent = p.amount;
        card.appendChild(amount);

        const price = document.createElement("div");
        price.className = "price";
        price.textContent = p.price;
        card.appendChild(price);

        const cta = document.createElement("div");
        cta.className = "cta";

        const buyBtn = document.createElement("button");
        buyBtn.className = "btn primary";
        buyBtn.textContent = "Sotib olish";
        buyBtn.addEventListener("click", ()=> openModal(p));
        cta.appendChild(buyBtn);

        const addBtn = document.createElement("button");
        addBtn.className = "btn";
        addBtn.textContent = "Savatchaga qo'shish";
        addBtn.addEventListener("click", ()=> {
          addToCart(p);
          renderCart(); // ensure immediate update
          toast("‚úÖ " + p.amount + " savatchaga qo'shildi");
        });
        cta.appendChild(addBtn);

        card.appendChild(cta);
        grid.appendChild(card);
      });
    }

    // =========================
    // CART
    // =========================
    function addToCart(p){
      const it = cart.find(x=>x.amount===p.amount);
      if(it) it.qty += 1;
      else cart.push({ amount: p.amount, price: p.price, qty: 1 });
      save("cart", cart);
      renderCart();
    }

    function removeFromCart(amount){
      cart = cart.filter(x=>x.amount !== amount);
      save("cart", cart);
      renderCart();
    }
    function changeQty(amount, delta){
      const it = cart.find(x=>x.amount===amount);
      if(!it) return;
      it.qty += delta;
      if(it.qty <= 0) removeFromCart(amount);
      else { save("cart", cart); renderCart(); }
    }

    function renderCart(){
      cartBody.innerHTML = "";
      let total = 0;
      cart.forEach(item=>{
        const price = currencyToNumber(item.price) * item.qty;
        total += price;
        const row = document.createElement("div");
        row.className = "cart-item";

        const left = document.createElement("div");
        left.style.fontWeight = "800";
        left.textContent = item.amount;
        row.appendChild(left);

        const right = document.createElement("div");
        right.style.display = "flex";
        right.style.alignItems = "center";
        right.style.gap = "8px";

        const minus = document.createElement("button"); minus.className="btn"; minus.textContent="‚àí";
        minus.addEventListener("click", ()=> changeQty(item.amount, -1));
        right.appendChild(minus);

        const qty = document.createElement("div"); qty.style.minWidth="28px"; qty.style.textAlign="center"; qty.textContent = item.qty;
        right.appendChild(qty);

        const plus = document.createElement("button"); plus.className="btn"; plus.textContent="+";
        plus.addEventListener("click", ()=> changeQty(item.amount, +1));
        right.appendChild(plus);

        const priceEl = document.createElement("div"); priceEl.style.fontWeight="800"; priceEl.textContent = numberToCurrency(price);
        right.appendChild(priceEl);

        const rem = document.createElement("button"); rem.className="btn"; rem.textContent="‚úñ";
        rem.addEventListener("click", ()=> removeFromCart(item.amount));
        right.appendChild(rem);

        row.appendChild(right);
        cartBody.appendChild(row);
      });

      // promo
      let discount = 0;
      if(promo && PROMOS[promo]) discount = Math.round(total * PROMOS[promo]);
      const final = total - discount;

      cartTotalEl.textContent = numberToCurrency(final);
      cartCountTop.textContent = cart.reduce((s,x)=>s+x.qty,0);
      $("#cartCountBadge").textContent = cart.reduce((s,x)=>s+x.qty,0);
    }

    // Clear cart
    $("#clearCartBtn").addEventListener("click", ()=> {
      cart = [];
      save("cart", cart);
      renderCart();
      toast("Savatcha tozalandi");
    });

    // Open/close drawer
    $("#openCartBtn").addEventListener("click", ()=> {
      drawer.classList.remove("hidden");
      drawer.setAttribute("aria-hidden","false");
    });
    $("#closeDrawerBtn").addEventListener("click", ()=> {
      drawer.classList.add("hidden");
      drawer.setAttribute("aria-hidden","true");
    });

    // =========================
    // TOAST
    // =========================
    function toast(msg, ms=3000){
      const el = document.createElement("div");
      el.className = "toast";
      el.textContent = msg;
      toasts.appendChild(el);
      setTimeout(()=> {
        el.style.opacity = 0; el.style.transform = "translateX(-8px)";
        setTimeout(()=> el.remove(), 300);
      }, ms);
    }

    // =========================
    // MODAL & ORDER
    // =========================
    function openModal(pack){
      selectedPack = pack;
      modalPack.textContent = `${pack.amount} ‚Ä¢ ${pack.price}`;
      modalBackdrop.style.display = "flex";
      modalBackdrop.setAttribute("aria-hidden","false");
      playerIdEl.focus();
    }
    function closeModal(){
      modalBackdrop.style.display = "none";
      modalBackdrop.setAttribute("aria-hidden","true");
      playerIdEl.value = ""; noteEl.value = "";
    }
    $("#closeModalBtn").addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", e => { if(e.target === modalBackdrop) closeModal(); });

    // choose payment
    $$("[data-pay]").forEach(b=>{
      b.addEventListener("click", ()=> {
        $$("[data-pay]").forEach(x=>x.classList.remove("active"));
        b.classList.add("active");
        selectedPay = b.dataset.pay;
      });
    });

    // Order a single pack (modal)
    $("#sendTg").addEventListener("click", ()=>{
      const id = playerIdEl.value.trim();
      if(!/^[0-9]{6,}$/.test(id)){ alert("Iltimos, to‚Äòg‚Äòri PUBG ID kiriting."); return; }

      const note = noteEl.value.trim();
      const payMap = {
        "UZCARD": "UZCARD: 5614 6887 0039 5675 ‚Äî Mengliyev Bahrom",
        "HUMO":   "HUMO: 9860 1201 4526 4012 ‚Äî Mengliyev Bahrom",
      };
      const header = "üéÆ PUBG Mobile UC buyurtma";
      const text =
`${header}

üí∞ ${selectedPack.amount}
üíµ ${selectedPack.price}
üî¢ ID: ${id}${note ? `\nüìù ${note}` : ""}

üí≥ ${payMap[selectedPay]}

üë§ Operator: @${TG_USERNAME}`;

      // Open Telegram
      const url = `https://t.me/${TG_USERNAME}?text=${encodeURIComponent(text)}`;
      window.open(url, "_blank", "noopener");

      // Increment stats (real purchase)
      incStat(selectedPack.amount);

      closeModal();
      toast("Buyurtma yuborildi. Operator bilan Telegram orqali bog'laning.");
      confetti();
    });

    // Order all in cart
    $("#orderCart").addEventListener("click", ()=>{
      if(cart.length === 0){ toast("Savatcha bo'sh"); return; }
      // Build text
      const lines = cart.map(it=> `‚Ä¢ ${it.amount} √ó ${it.qty} = ${numberToCurrency(currencyToNumber(it.price)*it.qty)} so'm`).join("\n");
      const total = cart.reduce((s,x)=> s + currencyToNumber(x.price)*x.qty, 0);
      const discount = promo && PROMOS[promo] ? Math.round(total * PROMOS[promo]) : 0;
      const final = total - discount;
      const text =
`üõí PUBG Mobile UC ‚Äî Savatcha

${lines}
${promo ? `\nüè∑ Promo: ${promo} (‚àí${numberToCurrency(discount)} so'm)` : ""}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üíµ Jami: ${numberToCurrency(final)} so'm

üë§ Operator: @${TG_USERNAME}`;

      const url = `https://t.me/${TG_USERNAME}?text=${encodeURIComponent(text)}`;
      window.open(url, "_blank", "noopener");

      // Stats: increment per cart item
      cart.forEach(it => incStat(it.amount, it.qty));
      cart = []; save("cart", cart); renderCart();
      toast("Buyurtma yuborildi. Operator bilan Telegram orqali bog'laning.");
      confetti();
    });

    // =========================
    // STATS: incStat, renderStats
    // =========================
    function incStat(amountOrCount, maybeCount){
      // if called with (amountString, qty) or (amountString)
      let qty = 1;
      let amountStr = amountOrCount;
      if(typeof maybeCount === "number") qty = maybeCount;

      // If first param is number (rare), treat as qty increments for small test
      // Parse UC count from string: e.g., "120 UC" => 120
      const ucEach = parseInt((amountStr||"").replace(/[^\d]/g,'')) || 0;
      statOrders = Number(statOrders || 0) + qty;
      statUC = Number(statUC || 0) + ucEach * qty;

      save("statOrders", statOrders);
      save("statUC", statUC);
      renderStats();
    }

    function renderStats(){
      $("#statOrders").textContent = numberToCurrency(statOrders || 0);
      $("#statUC").textContent = numberToCurrency(statUC || 0);
    }

    // Initialize stats on load
    renderStats();

    // =========================
    // FAKE PURCHASE (hourly, 1 per hour)
    // =========================
    function startFakePurchases(){
      // If lastFake older than interval, trigger one immediately (but only max one), then schedule next.
      const now = Date.now();
      const elapsed = now - (lastFake || 0);
      if(elapsed >= FAKE_PURCHASE_INTERVAL){
        // Do one fake now (but very small chance; ensure realistic)
        scheduleFake(0);
      }
      // Regular schedule: every FAKE_PURCHASE_INTERVAL
      setInterval(()=> scheduleFake(0), FAKE_PURCHASE_INTERVAL);
    }

    function scheduleFake(delayMs){
      setTimeout(()=>{
        // choose random pack from medium-large to look realistic
        const idx = Math.floor(Math.random() * PACKS.length);
        const p = PACKS[idx];
        // Only one fake per interval (we track timestamp)
        const now = Date.now();
        if(now - (lastFake || 0) < FAKE_PURCHASE_INTERVAL) return;
        // Apply fake
        lastFake = now;
        save("lastFake", lastFake);
        // Increase stats moderately (treat as single order)
        incStat(p.amount, 1);
        toast(`üî• So'nggi: anonim ‚Äî ${p.amount} sotib olindi`);
      }, delayMs);
    }

    // =========================
    // Testimonials
    // =========================
    function renderTestimonials(){
      const root = $("#testimonials");
      root.innerHTML = "";
      TESTIMONIALS.forEach(t=>{
        const el = document.createElement("div");
        el.className = "panel";
        el.innerHTML = `<div style="font-weight:800">${t.name}</div><div class="muted">${"‚òÖ".repeat(t.stars)}</div><p class="muted" style="margin-top:8px">${t.text}</p>`;
        root.appendChild(el);
      });
    }

    // =========================
    // COUNTDOWN
    // =========================
    function tickCountdown(){
      const now = Date.now();
      const diff = Math.max(0, DEAL_END - now);
      const d = Math.floor(diff / 86400000);
      const h = Math.floor((diff % 86400000) / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);
      $("#d").textContent = d; $("#h").textContent = h; $("#m").textContent = m; $("#s").textContent = s;
    }

    // =========================
    // COPY CARD NUMBERS
    // =========================
    $$("[data-copy]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const val = btn.dataset.copy;
        if(navigator.clipboard && navigator.clipboard.writeText){
          navigator.clipboard.writeText(val).then(()=> {
            toast("Nusxa olindi ‚úÖ");
          }).catch(()=> { toast("Clipboardga yozib bo‚Äòlmadi"); });
        } else {
          toast("Clipboard not supported");
        }
      });
    });

    // =========================
    // Helpers: confetti
    // =========================
    function confetti(){
      // small confetti effect
      const root = document.getElementById("confettiRoot");
      for(let i=0;i<30;i++){
        const el = document.createElement("div");
        el.className = "confetti-piece";
        el.style.left = Math.random()*100 + "%";
        el.style.top = "-10%";
        el.style.background = ["#ff6b35","#f7931e","#ffd24d","#06b6d4"][Math.floor(Math.random()*4)];
        el.style.transform = `rotate(${Math.random()*360}deg)`;
        document.body.appendChild(el);
        const endY = window.innerHeight + 50 + Math.random()*200;
        const dur = 800 + Math.random()*1200;
        el.animate([{ transform: `translateY(0) rotate(0deg)`, opacity:1 },{ transform: `translateY(${endY}px) rotate(360deg)`, opacity:0 }], { duration: dur, easing: "cubic-bezier(.2,.8,.2,1)" });
        setTimeout(()=> el.remove(), 1600);
      }
    }

    // =========================
    // INIT
    // =========================
    function init(){
      renderPacks();
      renderCart();
      renderTestimonials();
      tickCountdown(); setInterval(tickCountdown, 1000);
      startFakePurchases();
      // Greeting
      const h = new Date().getHours();
      const greet = h < 11 ? "Xayrli tong!" : h < 18 ? "Assalomu alaykum!" : "Xayrli kech!";
      $("#greet").textContent = greet + " ‚Äî Eng arzon narxlar";

      // Modal ESC
      window.addEventListener("keydown", e => { if(e.key === "Escape") closeModal(); });

      // Theme toggle
      $("#themeToggle").addEventListener("click", ()=> {
        const cur = document.documentElement.getAttribute("data-theme");
        const next = cur === "light" ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", next);
      });

      // Promo application (if you plan to add UI)
      // Language/other small binds can be added similarly
    }

    // Start
    init();

    // Accessibility: ensure stats saved on unload
    window.addEventListener("beforeunload", ()=> {
      save("cart", cart);
      save("statOrders", statOrders);
      save("statUC", statUC);
      save("lastFake", lastFake);
    });

  </script>
</body>
</html>
